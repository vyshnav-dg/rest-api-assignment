<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>API Tester - Customers, Products, Orders</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
    }
    h1 {
      color: #2c3e50;
    }
    h2 {
      background: #2c3e50;
      color: #fff;
      padding: 10px;
    }
    .section {
      background: #fff;
      padding: 15px;
      margin-bottom: 30px;
      border: 1px solid #ccc;
    }
    label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin-top: 2px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    button {
      padding: 10px 15px;
      margin-top: 10px;
      background-color: #3498db;
      border: none;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    textarea {
      height: 150px;
      font-family: monospace;
    }
  </style>
</head>
<body>

<h1>API Tester for Customers, Products, Orders</h1>

<!-- ------------------------- CUSTOMERS SECTION ------------------------- -->
<div class="section">
  <h2>Customers</h2>
  <button onclick="getAll('customers')">Get All Customers</button>
  <textarea id="customersOutput" readonly></textarea>

  <h3>Insert Customer (POST)</h3>
  <div id="customerPostForm">
    <label>CustomerID</label><input id="CustomerID_post" />
    <label>CompanyName</label><input id="CompanyName" />
    <label>ContactName</label><input id="ContactName" />
    <label>ContactTitle</label><input id="ContactTitle" />
    <label>Address</label><input id="Address" />
    <label>City</label><input id="City" />
    <label>Region</label><input id="Region" />
    <label>PostalCode</label><input id="PostalCode" />
    <label>Country</label><input id="Country" />
    <label>Phone</label><input id="Phone" />
    <label>Fax</label><input id="Fax" />
    <button onclick="postCustomer()">POST Customer</button>
  </div>

  <h3>Update Customer (PATCH)</h3>
  <label>CustomerID (to update)</label><input id="PatchCustomerID" />
  <input id="PatchCompanyName" placeholder="CompanyName" />
  <button onclick="patchCustomer()">PATCH Customer</button>
</div>

<!-- ------------------------- PRODUCTS SECTION ------------------------- -->
<div class="section">
  <h2>Products</h2>
  <button onclick="getAll('products')">Get All Products</button>
  <textarea id="productsOutput" readonly></textarea>

  <h3>Insert Product (POST)</h3>
  <div id="productPostForm">
    <label>ProductID</label><input id="ProductID" />
    <label>ProductName</label><input id="ProductName" />
    <label>SupplierID</label><input id="SupplierID" type="number" />
    <label>CategoryID</label><input id="CategoryID" type="number" />
    <label>QuantityPerUnit</label><input id="QuantityPerUnit" />
    <label>UnitPrice</label><input id="UnitPrice" type="number" step="0.01" />
    <label>UnitsInStock</label><input id="UnitsInStock" type="number" />
    <label>UnitsOnOrder</label><input id="UnitsOnOrder" type="number" />
    <label>ReorderLevel</label><input id="ReorderLevel" type="number" />
    <label>Discontinued</label><input id="Discontinued" type="checkbox" />
    <button onclick="postProduct()">POST Product</button>
  </div>

  <h3>Update Product (PATCH)</h3>
  <label>ProductID (to update)</label><input id="PatchProductID" type="number" />
  <input id="PatchProductName" placeholder="ProductName" />
  <input id="PatchUnitPrice" placeholder="UnitPrice" type="number" step="0.01" />
  <button onclick="patchProduct()">PATCH Product</button>
</div>

<!-- ------------------------- ORDERS SECTION ------------------------- -->
<div class="section">
  <h2>Orders</h2>
  <button onclick="getAll('orders')">Get All Orders</button>
  <textarea id="ordersOutput" readonly></textarea>

  <h3>Insert Order (POST)</h3>
  <label>OrderID</label><input id="OrderID" />
  <label>CustomerID</label><input id="CustomerID" />
  <label>EmployeeID</label><input id="EmployeeID" type="number" />
  <label>OrderDate</label><input id="OrderDate" type="date" />
  <label>RequiredDate</label><input id="RequiredDate" type="date" />
  <label>ShippedDate</label><input id="ShippedDate" type="date" />
  <label>ShipVia</label><input id="ShipVia" type="number" />
  <label>Freight</label><input id="Freight" type="number" step="0.01" />
  <label>ShipName</label><input id="ShipName" />
  <label>ShipAddress</label><input id="ShipAddress" />
  <label>ShipCity</label><input id="ShipCity" />
  <label>ShipRegion</label><input id="ShipRegion" />
  <label>ShipPostalCode</label><input id="ShipPostalCode" />
  <label>ShipCountry</label><input id="ShipCountry" />
  <button onclick="postOrder()">POST Order</button>

  <h3>Update Order (PATCH)</h3>
  <label>OrderID (to update)</label><input id="PatchOrderID" type="number" />
  <input id="PatchShipName" placeholder="ShipName" />
  <button onclick="patchOrder()">PATCH Order</button>
</div>

<script>
  const apiUrl = 'http://localhost:5000'; // Change to your API base URL
function getAll(model) {
  fetch(`${apiUrl}/${model}`)
    .then(res => res.json())
    .then(data => {
      document.getElementById(`${model}Output`).value = JSON.stringify(data, null, 2);
    })
    .catch(err => alert(`Error fetching ${model}: ${err}`));
}

function postProduct() {
  const product = {
    ProductID: document.getElementById('ProductID').value ? parseInt(document.getElementById('ProductID').value) : undefined,
    ProductName: document.getElementById('ProductName').value.trim() || undefined,
    SupplierID: document.getElementById('SupplierID').value ? parseInt(document.getElementById('SupplierID').value) : undefined,
    CategoryID: document.getElementById('CategoryID').value ? parseInt(document.getElementById('CategoryID').value) : undefined,
    QuantityPerUnit: document.getElementById('QuantityPerUnit').value.trim() || undefined,
    UnitPrice: document.getElementById('UnitPrice').value ? parseFloat(document.getElementById('UnitPrice').value) : undefined,
    UnitsInStock: document.getElementById('UnitsInStock').value ? parseInt(document.getElementById('UnitsInStock').value) : undefined,
    UnitsOnOrder: document.getElementById('UnitsOnOrder').value ? parseInt(document.getElementById('UnitsOnOrder').value) : undefined,
    ReorderLevel: document.getElementById('ReorderLevel').value ? parseInt(document.getElementById('ReorderLevel').value) : undefined,
    Discontinued: document.getElementById('Discontinued').checked ? true : undefined
  };
  const cleanProduct = Object.fromEntries(Object.entries(product).filter(([_, v]) => v !== undefined));
  console.log(cleanProduct)
  fetch(`${apiUrl}/products`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(cleanProduct)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error} + ${response.message}`);
      } else {
        alert(`Product inserted successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error posting product: ${err}`));
}

function patchProduct() {
  const id = document.getElementById('PatchProductID').value;
  const body = {};
  if (document.getElementById('PatchProductName').value) body.ProductName = document.getElementById('PatchProductName').value;
  if (document.getElementById('PatchUnitPrice').value) body.UnitPrice = parseFloat(document.getElementById('PatchUnitPrice').value);

  fetch(`${apiUrl}/products/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error}`);
      } else {
        alert(`Product updated successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error updating product: ${err}`));
}

function postOrder() {
const body = {
  OrderID: document.getElementById("OrderID").value ? parseInt(document.getElementById("OrderID").value) : undefined,
  CustomerID: document.getElementById('CustomerID').value.trim() || undefined,
  EmployeeID: document.getElementById('EmployeeID').value ? parseInt(document.getElementById('EmployeeID').value) : undefined,
  OrderDate: document.getElementById('OrderDate').value.trim() || undefined,
  RequiredDate: document.getElementById('RequiredDate').value.trim() || undefined,
  ShippedDate: document.getElementById('ShippedDate').value.trim() || undefined,
  ShipVia: document.getElementById('ShipVia').value ? parseInt(document.getElementById('ShipVia').value) : undefined,
  Freight: document.getElementById('Freight').value ? parseFloat(document.getElementById('Freight').value) : undefined,
  ShipName: document.getElementById('ShipName').value.trim() || undefined,
  ShipAddress: document.getElementById('ShipAddress').value.trim() || undefined,
  ShipCity: document.getElementById('ShipCity').value.trim() || undefined,
  ShipRegion: document.getElementById('ShipRegion').value.trim() || undefined,
  ShipPostalCode: document.getElementById('ShipPostalCode').value.trim() || undefined,
  ShipCountry: document.getElementById('ShipCountry').value.trim() || undefined
};

const cleanBody = Object.fromEntries(Object.entries(body).filter(([_, v]) => v !== undefined));

  fetch(`${apiUrl}/orders`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(cleanBody)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error} + ${response.message}`);
      } else {
        alert(`Order inserted successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error posting order: ${err}`));
}

function patchOrder() {
  const id = document.getElementById('PatchOrderID').value;
  const body = {};
  if (document.getElementById('PatchShipName').value) body.ShipName = document.getElementById('PatchShipName').value;

  fetch(`${apiUrl}/orders/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error}`);
      } else {
        alert(`Order updated successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error updating order: ${err}`));
}

function postCustomer() {
  const _body = {
    CustomerID: document.getElementById('CustomerID_post').value,
    CompanyName: document.getElementById('CompanyName').value,
    ContactName: document.getElementById('ContactName').value,
    ContactTitle: document.getElementById('ContactTitle').value,
    Address: document.getElementById('Address').value,
    City: document.getElementById('City').value,
    Region: document.getElementById('Region').value,
    PostalCode: document.getElementById('PostalCode').value,
    Country: document.getElementById('Country').value,
    Phone: document.getElementById('Phone').value,
    Fax: document.getElementById('Fax').value
  };
  console.log(JSON.stringify(_body))
  fetch(`${apiUrl}/customers`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(_body)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error} + ${response.message}`);
      } else {
        alert(`Customer inserted successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error posting customer: ${err}`));
}

function patchCustomer() {
  const id = document.getElementById('PatchCustomerID').value;
  const body = {};
  if (document.getElementById('PatchCompanyName').value) body.CompanyName = document.getElementById('PatchCompanyName').value;

  fetch(`${apiUrl}/customers/${id}`, {
    method: 'PATCH',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(body)
  })
    .then(r => r.json())
    .then(response => {
      if (response.error) {
        alert(`Error: ${response.error}`);
      } else {
        alert(`Customer updated successfully: ${JSON.stringify(response)}`);
      }
    })
    .catch(err => alert(`Error updating customer: ${err}`));
}
</script>

</body>
</html>
